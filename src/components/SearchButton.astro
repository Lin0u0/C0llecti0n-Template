---
/**
 * SearchButton - Inline search trigger button
 * Opens the global search modal when clicked
 *
 * Variants:
 * - "home": Larger button for homepage, matches category-pill style, shows "Search"
 * - "page": Compact button for library/cinema pages, matches SortToggle style, shows "搜索"
 */

interface Props {
    variant?: "home" | "page";
}

const { variant = "page" } = Astro.props;
const buttonText = variant === "home" ? "Search" : "搜索";
---

<button
    class:list={["search-trigger", `search-trigger--${variant}`]}
    aria-label="Search"
    title="搜索 (⌘K)"
>
    <svg
        class="search-trigger-icon"
        width="12"
        height="12"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round"
    >
        <circle cx="11" cy="11" r="8"></circle>
        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
    </svg>
    <span class="search-trigger-text">{buttonText}</span>
</button>

<style>
    /* Base styles shared by both variants */
    .search-trigger {
        display: inline-flex;
        align-items: center;
        gap: var(--space-sm);
        background: var(--bg-wall);
        border: 1px solid var(--border-subtle);
        color: var(--text-primary);
        border-radius: 20px;
        font-family: var(--font-body);
        font-weight: 500;
        letter-spacing: 0.05em;
        cursor: pointer;
        transition: all var(--transition-fast);
        white-space: nowrap;
        /* Dark mode: raised (convex) button with subtle highlights */
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        box-shadow:
            0 2px 4px rgba(0, 0, 0, 0.4),
            0 1px 2px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1),
            inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        border-top-color: rgba(255, 255, 255, 0.08);
        border-bottom-color: rgba(0, 0, 0, 0.3);
    }

    /* Page variant - matches SortToggle size exactly */
    .search-trigger--page {
        padding: 4px 12px;
        font-size: 0.8rem;
    }

    /* Home variant - matches category-pill size */
    .search-trigger--home {
        padding: 8px 16px;
        font-size: 0.9rem;
    }

    @media (hover: hover) {
        .search-trigger:hover {
            border-color: var(--text-muted);
            color: var(--text-primary);
            background: var(--bg-shelf);
            box-shadow:
                0 3px 6px rgba(0, 0, 0, 0.5),
                0 1px 3px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.12),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
        }

        :global([data-theme="light"]) .search-trigger:hover {
            box-shadow:
                0 3px 6px rgba(0, 0, 0, 0.15),
                0 1px 3px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.95),
                inset 0 -1px 0 rgba(0, 0, 0, 0.05);
        }
    }

    .search-trigger:active {
        transform: translateY(1px);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Light mode */
    :global([data-theme="light"]) .search-trigger {
        color: var(--text-secondary);
        text-shadow: 0 1px 0 rgba(255, 255, 255, 0.7);
        box-shadow:
            0 2px 4px rgba(0, 0, 0, 0.12),
            0 1px 2px rgba(0, 0, 0, 0.08),
            inset 0 1px 0 rgba(255, 255, 255, 0.9),
            inset 0 -1px 0 rgba(0, 0, 0, 0.05);
        border-top-color: rgba(255, 255, 255, 0.5);
        border-bottom-color: rgba(0, 0, 0, 0.1);
    }

    :global([data-theme="light"]) .search-trigger:active {
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.12);
    }

    .search-trigger-icon {
        opacity: 0.8;
        flex-shrink: 0;
    }

    .search-trigger-text {
        font-weight: 500;
    }

    /* Mobile: hide text */
    @media (max-width: 600px) {
        .search-trigger-text {
            display: none;
        }

        .search-trigger--page {
            padding: 6px 10px;
        }

        .search-trigger--home {
            padding: 8px 12px;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const buttons = document.querySelectorAll(".search-trigger");

        buttons.forEach((button) => {
            button.addEventListener("click", () => {
                if (typeof (window as any).openGlobalSearch === "function") {
                    (window as any).openGlobalSearch();
                }
            });
        });
    });
</script>
